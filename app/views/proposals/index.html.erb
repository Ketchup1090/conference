<%
# VARIABLES:
# * @event => Event these proposals are for
# * @proposals => Array of proposal objects
# * @kind => Symbol indicating mode, either :proposals or :sessions
%>

<% page_title "#{@event.title} #{@kind}" %>

<%
cache_key = "#{@kind}_index_#{@event.id}"
cache_key << "_#{params[:sort]}_#{params[:dir]}" if params[:sort]
%>

<% cache_if(!logged_in?, cache_key) do %>
  <div>
    <% if @kind == :proposals %>
      <% if accepting_proposals? %>
        <p>
          <%= simple_format @event.open_text %>
          <% if admin? %>
            <%= link_to "Edit", edit_manage_event_path(@event), :class => "editable" %>
          <% end %>
        </p>
        <div class="submit-a-proposal-wrapper">
          <%= link_to 'Submit a proposal!', new_event_proposal_path(@event), :class => "submit-a-proposal-button" %>
        </div>
      <% else %>
          <%= simple_format @event.closed_text %>
          <% if admin? %>
            <%= link_to "Edit", edit_manage_event_path(@event), :class => "editable" %>
          <% end %>
      <% end %>
    <% elsif @kind == :sessions %>
      <p>
        <%= simple_format @event.session_text %>
        <% if admin? %>
          <%= link_to "Edit", edit_manage_event_path(@event), :class => "editable" %>
        <% end %>
      </p>
    <% else %>
      <% raise TypeError, "Unknown kind: #{@kind.class.name.inspect}" %>
    <% end %>
  </div>

  <%= render :partial => "list", :locals => {:kind => @kind, :records => @proposals, :sorter => true} %>
<% end %>
